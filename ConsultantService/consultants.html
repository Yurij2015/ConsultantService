<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Список консультантов</title>
    <link href="Content/Site.css" rel="stylesheet" />
    <link href="Content/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="container">
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">YourConsult</a>
            </div>
            <ul class="nav navbar-nav">
                <li><a href="/">Main</a></li>
                <li class="active"><a href="consultants.html">Consultants</a></li>
                <li ><a href="#">Consultations</a></li>
                <li><a href="#">About</a></li>

            </ul>
        </div>
    </nav>
    <div id="tableBlock"></div>
    <hr />
    <div id="editBlock">
        <p><b>Редактирование данных консультанта</b></p>
        <table class="table table-hover">
            <input type="hidden" id="editId" />
            <tr><td><label>ФИО консультанта: </label></td><td><input class="form-control" type="text" id="editName" /></td></tr>
            <tr><td><label>Электронная почта: </label></td><td><input class="form-control" type="text" id="editEmail" /></td></tr>
            <tr><td><label>Номер телефона: </label></td><td><input class="form-control" type="number" id="editPhone" /></td></tr>
            <tr><td><label>Портфолио: </label></td><td><textarea class="form-control" type="number" id="editPortfolio"></textarea></td></tr>
            <tr><td><label>Услуги: </label></td><td><textarea class="form-control" type="number" id="editServices"></textarea></td></tr>
        </table>
        <button id="editConsultant" class="btn btn-primary">Сохранить</button>
    </div>
    <div id="createBlock">
        <p><b>Добавление консультанта</b></p>
        <table class="table table-hover">
            <tr><td><label>ФИО консультанта: </label></td><td><input class="form-control" type="text" id="addName" /></td></tr>
            <tr><td><label>Электронная почта: </label></td><td><input class="form-control" type="text" id="addEmail" /></td></tr>
            <tr><td><label>Номер телефона: </label></td><td><input class="form-control col-lg-12" type="number" id="addPhone" /></td></tr>
            <tr><td><label>Портфолио: </label></td><td><textarea class="form-control" type="number" id="addPortfolio"></textarea></td></tr>
            <tr><td><label>Услуги: </label></td><td><textarea class="form-control col-md-12" type="number" id="addServices"></textarea></td></tr>
        </table>
        <button id="addConsultant" class="btn btn-primary">Сохранить</button>
    </div>
    <div class="row">
        <footer>
            <hr />
            <p>
                Консультации юристов
            </p>
        </footer>
    </div>

</body>
</html>
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {

        GetAllConsultations();

        $("#editConsultation").click(function (event) {
            event.preventDefault();
            EditConsultation();
        });

        $("#addConsultation").click(function (event) {
            event.preventDefault();
            AddConsultation();
        });

    });
    // Получение всех консультантов по ajax-запросу
    function GetAllConsultations() {

        $("#createBlock").css('display', 'block');
        $("#editBlock").css('display', 'none');
        $.ajax({
            url: '/api/consultants',
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                WriteResponse(data);
            },
            error: function (x, y, z) {
                alert(x + '\n' + y + '\n' + z);
            }
        });
    }
    // Добавление новой записи
    function AddConsultation() {
        // получаем значения для добавляемой записи
        var consultation = {
            Name: $('#addName').val(),
            Author: $('#addAuthor').val(),
            Year: $('#addYear').val()
        };

        $.ajax({
            url: '/api/ConsultationsWeb/',
            type: 'POST',
            data: JSON.stringify(consultation),
            contentType: "application/json;charset=utf-8",
            success: function (data) {
                GetAllConsultations();
            },
            error: function (x, y, z) {
                alert(x + '\n' + y + '\n' + z);
            }
        });
    }
    // Удаление консультации
    function DeleteConsultation(id) {

        $.ajax({
            url: '/api/ConsultationsWeb/' + id,
            type: 'DELETE',
            contentType: "application/json;charset=utf-8",
            success: function (data) {
                GetAllConsultations();
            },
            error: function (x, y, z) {
                alert(x + '\n' + y + '\n' + z);
            }
        });
    }
    // редактирование консультации
    function EditConsultation() {
        var id = $('#editId').val()
        // получаем новые значения для редактируемой консультации
        var consultation = {
            Id: $('#editId').val(),
            Name: $('#editName').val(),
            Email: $('#editEmail').val(),
            Phone: $('#editPhone').val()
        };
        $.ajax({
            url: '/api/ConsultationsWeb/' + id,
            type: 'PUT',
            data: JSON.stringify(consultation),
            contentType: "application/json;charset=utf-8",
            success: function (data) {
                GetAllConsultations();
            },
            error: function (x, y, z) {
                alert(x + '\n' + y + '\n' + z);
            }
        });
    }
    // вывод полученных данных на экран
    function WriteResponse(consultations) {
        var strResult = "<table class='table table-hover'><th>ID</th><th>Название</th><th>Автор</th><th>Год издания</th><th></th><th></th>";
        $.each(consultations, function (index, consultation) {
            strResult += "<tr><td>" + consultation.Id + "</td><td> " + consultation.Name + "</td><td>" +
                consultation.Email + "</td><td>" + consultation.Phone +
                "</td><td><a id='editItem' data-item='" + consultation.Id + "' onclick='EditItem(this);' >Редактировать</a></td>" +
                "<td><a id='delItem' data-item='" + consultation.Id + "' onclick='DeleteItem(this);' >Удалить</a></td></tr>";
        });
        strResult += "</table>";
        $("#tableBlock").html(strResult);

    }
    // обработчик удаления
    function DeleteItem(el) {
        // получаем id удаляемого объекта
        var id = $(el).attr('data-item');
        DeleteConsultation(id);
    }
    // обработчик редактирования
    function EditItem(el) {
        // получаем id редактируемого объекта
        var id = $(el).attr('data-item');
        GetConsultation(id);
    }
    // вывод данных редактируемой книги в поля для редактирования
    function ShowConsultation(consultation) {
        if (consultation != null) {
            $("#createBlock").css('display', 'none');
            $("#editBlock").css('display', 'block');
            $("#editId").val(consultation.Id);
            $("#editName").val(consultation.Name);
            $("#editPhone").val(consultation.Phone);
            $("#editEmail").val(consultation.Email);
        }
        else {
            alert("Такая книга не существует");
        }
    }
    // запрос книги на редактирование
    function GetConsultation(id) {
        $.ajax({
            url: '/api/ConsultationsWeb/' + id,
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                ShowConsultation(data);
            },
            error: function (x, y, z) {
                alert(x + '\n' + y + '\n' + z);
            }
        });
    }
</script>